###########################################################################################################################################################################################################################################################################################################################################################################################################################################
# Moodmecodynamics: Roel van Dooren, Roy de Kleijn, Bernhard Hommel, & Zsuzsika Sjoerds
###########################################################################################################################################################################################################################################################################################################################################################################################################################################
### Last adjustment on: 27-01-2020
### r.van.dooren@fsw.leidenuniv.nl

rm(list = ls()) # Clean workspace.

###########################################################################################################################################################################################################################################################################################################################################################################################################################################
# Load the main workspace -------------------------------------------------
###########################################################################################################################################################################################################################################################################################################################################################################################################################################

load("./workspaces/general-workspace.RData")

###########################################################################################################################################################################################################################################################################################################################################################################################################################################
# Import libraries --------------------------------------------------------
###########################################################################################################################################################################################################################################################################################################################################################################################################################################

ipak <- function(pkg) {
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = T)
  sapply(pkg, require, character.only = T)
}
packages <- c("plyr", "zeallot", "Rmisc", "ggplot2", "cowplot", "MBESS", "rstatix", "psych",
              "ez", "apaTables", "dplyr", "data.table") # Make sure to load dplyr after plyr and ggplot2
ipak(packages)

###########################################################################################################################################################################################################################################################################################################################################################################################################################################
# Read demographics datafile ----------------------------------------------
###########################################################################################################################################################################################################################################################################################################################################################################################################################################

demographics <- read.csv2('./data-demographics/demographics.csv', header = T)
head(demographics)

names(which(with(demographics, table(ID)) > 1)) # Good, we don't have any double participant numbers

# Remove subject 9 and 91 as they did not complete the full experiment
demographics <- demographics[-which(demographics$ID %in% c(9, 91)), ]

# Check gender distribution
with(demographics, table(Sex))

# Check mean age and SD
summarySE(demographics, measurevar = 'Age', na.rm = T)

# Check age range
min(demographics$Age); max(demographics$Age)

###########################################################################################################################################################################################################################################################################################################################################################################################################################################
# Read foraging practice datafiles ----------------------------------------
###########################################################################################################################################################################################################################################################################################################################################################################################################################################

practice_dat <- data.frame()
for (f in list.files('./data-foraging-practice/', full.names = T)) {
  data <- read.csv2(f, dec='.', sep=',', header = TRUE, stringsAsFactors = FALSE)

  # Only process datafiles of participants that will not be ommited from the data (see line 83 of analysis.R).
  if (!unique(data$expStartTime) %in% expStartTime_to_remove) { # Removes subjects 9 and 91.
    # If required, replace subjectID based on expStartTime (see line 84).
    if (unique(data$expStartTime) %in% as.numeric(names(expStartTime_to_recode))) {
      data$subjectID = expStartTime_to_recode[which(unique(data$expStartTime) == as.numeric(names(expStartTime_to_recode)))][[1]]
    }
    practice_dat <- rbind(practice_dat, data)
  }
}

# Check whether the data is complete for all subjects
names(which(with(practice_dat, table(subjectID)) != 1)) # All fine!

# Check the mean duration of the practice trial
summarySE(practice_dat, measurevar = 'totaltrialtime', na.rm = T)